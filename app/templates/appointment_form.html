{% extends "base.html" %}

{% block title %}{% if appointment %}Edit{% else %}Add{% endif %} Appointment{% endblock %}

{% block content %}
<h2>{% if appointment %}Edit{% else %}Add{% endif %} Appointment</h2>

{% if error %}
<div class="alert alert-danger" role="alert">
    {{ error }}
</div>
{% endif %}

<form method="POST">
    <div class="mb-3">
        <label class="form-label">Caregiver</label>
        <select class="form-control" name="caregiver_user_id" required>
            <option value="">Select a caregiver...</option>
            {% for c in caregivers %}
            <option value="{{ c.caregiver_user_id }}" 
                {% if appointment and appointment.caregiver_user_id == c.caregiver_user_id %}selected{% endif %}>
                {{ c.given_name }} {{ c.surname }}
            </option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Member</label>
        <select class="form-control" name="member_user_id" required>
            <option value="">Select a member...</option>
            {% for m in members %}
            <option value="{{ m.member_user_id }}" 
                {% if appointment and appointment.member_user_id == m.member_user_id %}selected{% endif %}>
                {{ m.given_name }} {{ m.surname }}
            </option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Date</label>
        <input type="date" class="form-control" name="appointment_date" 
               value="{{ appointment.appointment_date if appointment else '' }}" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Time</label>
        <input type="time" class="form-control" name="appointment_time" 
               value="{{ appointment.appointment_time if appointment else '' }}" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Work Hours</label>
        <input type="number" step="0.5" min="0.5" max="24" class="form-control" name="work_hours" 
               value="{{ appointment.work_hours if appointment else '' }}" 
               placeholder="e.g., 2, 4.5, 8" 
               title="Work hours must be between 0.5 and 24" required>
        <small class="text-muted">Enter hours between 0.5 and 24 (e.g., 2, 4.5, 8)</small>
    </div>
    <div class="mb-3">
        <label class="form-label">Status</label>
        <select class="form-control" name="status" required>
            <option value="pending" {% if appointment and appointment.status == 'pending' %}selected{% endif %}>Pending</option>
            <option value="confirmed" {% if appointment and appointment.status == 'confirmed' %}selected{% endif %}>Confirmed</option>
            <option value="declined" {% if appointment and appointment.status == 'declined' %}selected{% endif %}>Declined</option>
            <option value="cancelled" {% if appointment and appointment.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
            <option value="completed" {% if appointment and appointment.status == 'completed' %}selected{% endif %}>Completed</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Save</button>
    <a href="/web/appointments" class="btn btn-secondary">Cancel</a>
</form>
{% endblock %}
